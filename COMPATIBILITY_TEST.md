# 🧪 MVU扩展兼容性测试清单

## 📋 测试前准备

### 1. 环境要求
- [ ] SillyTavern版本 >= 1.13.4
- [ ] 已卸载酒馆助手版MVU（如果有）
- [ ] 浏览器控制台已打开（F12）

### 2. 测试角色卡准备
需要准备以下类型的MVU角色卡进行测试：
- [ ] 包含InitVar世界书的角色卡
- [ ] 使用变量命令的角色卡
- [ ] 使用{{get_message_variable}}宏的角色卡

## ✅ 核心功能兼容性测试

### 1. 世界书InitVar初始化
**测试步骤：**
1. 导入包含[initvar]标记的世界书
2. 开始新对话
3. 检查控制台是否显示 `[MVU] 找到InitVar条目`

**预期结果：**
- [ ] 变量成功初始化
- [ ] 控制台无错误
- [ ] toast提示"世界书初始变量加载成功"

**测试数据示例：**
```yaml
# 世界书条目，注释包含[initvar]
player:
  name: "测试玩家"
  hp: 100
  level: 1
npc:
  name: "测试NPC"
  affection: 0
```

### 2. 变量命令解析测试

#### 2.1 _.set命令
**测试文本：**
```
_.set('player.hp', 80); // 受到伤害
```
**预期结果：**
- [ ] player.hp更新为80
- [ ] 控制台显示更新日志
- [ ] delta_data记录变化

#### 2.2 _.insert/assign命令
**测试文本：**
```
_.insert('inventory', 'sword'); // 获得物品
_.assign('player', {exp: 100}); // 添加经验
```
**预期结果：**
- [ ] inventory数组添加'sword'
- [ ] player对象添加exp属性
- [ ] 无报错

#### 2.3 _.remove/delete命令
**测试文本：**
```
_.remove('inventory', 'sword'); // 移除物品
_.delete('temp_var'); // 删除临时变量
```
**预期结果：**
- [ ] 成功移除指定项
- [ ] 变量被删除
- [ ] 无报错

#### 2.4 _.add命令
**测试文本：**
```
_.add('player.level', 1); // 等级提升
_.add('game.time', 3600000); // 时间增加1小时
```
**预期结果：**
- [ ] 数值正确增加
- [ ] 日期时间正确处理
- [ ] 无报错

### 3. UpdateVariable块解析
**测试文本：**
```
<UpdateVariable>
<Analysis>角色进行了战斗，需要更新状态</Analysis>
_.set('player.hp', 75);
_.add('player.exp', 50);
_.insert('battle_log', 'Victory!');
</UpdateVariable>
```
**预期结果：**
- [ ] 正确识别UpdateVariable块
- [ ] 解析Analysis内容
- [ ] 执行所有命令
- [ ] 变量正确更新

### 4. 变量宏替换测试

#### 4.1 {{get_message_variable}}格式
**测试文本：**
```
当前状态：{{get_message_variable::stat_data}}
玩家HP：{{get_message_variable::player.hp}}
```
**预期结果：**
- [ ] 正确替换为变量值
- [ ] JSON格式正确
- [ ] 无undefined显示

#### 4.2 <%= getvar() %>格式
**测试文本：**
```
等级：<%= getvar('player.level') %>
物品：<%= getvar('inventory') %>
```
**预期结果：**
- [ ] 正确替换为变量值
- [ ] 格式正确
- [ ] 无报错

### 5. 斜杠命令测试

#### 5.1 /mvu_set
**测试命令：**
```
/mvu_set player.name "测试角色"
/mvu_set npc.affection 50
```
**预期结果：**
- [ ] 变量设置成功
- [ ] 值类型正确
- [ ] 返回确认消息

#### 5.2 /mvu_get
**测试命令：**
```
/mvu_get player
/mvu_get npc.affection
```
**预期结果：**
- [ ] 正确返回变量值
- [ ] 嵌套路径工作正常
- [ ] 无报错

#### 5.3 /mvu_reset
**测试命令：**
```
/mvu_reset
```
**预期结果：**
- [ ] 出现确认对话框
- [ ] 确认后变量重置
- [ ] toast提示成功

### 6. UI功能测试

#### 6.1 面板显示
- [ ] MVU面板正确显示
- [ ] 折叠/展开功能正常
- [ ] 样式正确应用

#### 6.2 设置保存
- [ ] 通知设置保存生效
- [ ] 更新方式切换正常
- [ ] 刷新后设置保留

#### 6.3 功能按钮
- [ ] 重新处理变量按钮工作
- [ ] 重新读取初始变量按钮工作
- [ ] 快照楼层功能正常
- [ ] 重演楼层功能正常
- [ ] 清除旧楼层变量功能正常

### 7. 高级功能测试

#### 7.1 额外模型解析
**前置条件：** 设置更新方式为"额外模型解析"
- [ ] [mvu_plot]标记条目正确过滤
- [ ] [mvu_update]标记条目正确识别
- [ ] 模型切换正常

#### 7.2 变量Schema验证
**测试场景：** 使用带schema的角色卡
- [ ] extensible属性生效
- [ ] required属性验证
- [ ] 类型检查工作

#### 7.3 变量快照与恢复
- [ ] 快照创建成功
- [ ] 恢复到快照点正常
- [ ] 数据完整性保持

### 8. 性能测试

#### 8.1 大数据量处理
- [ ] 100+变量正常工作
- [ ] 深层嵌套(5层+)正常
- [ ] 大数组(1000+元素)处理正常

#### 8.2 响应速度
- [ ] 变量更新延迟<100ms
- [ ] UI响应流畅
- [ ] 无内存泄漏

### 9. 错误处理测试

#### 9.1 异常输入
- [ ] 无效命令语法有错误提示
- [ ] 不存在的路径有提示
- [ ] 类型不匹配有警告

#### 9.2 恢复能力
- [ ] 错误后可继续工作
- [ ] 数据不会损坏
- [ ] 有错误日志记录

## 📊 兼容性评分

### 评分标准
- **完全兼容(100%)**: 所有测试项通过
- **高度兼容(90%+)**: 核心功能全部通过，个别高级功能有问题
- **基本兼容(70%+)**: 基础功能正常，部分功能需要调整
- **不兼容(<70%)**: 需要重大修改

### 测试结果汇总
- 总测试项：_____ 个
- 通过项：_____ 个
- 失败项：_____ 个
- **兼容性评分：_____ %**

## 🐛 已知问题记录

### 问题1
- **描述**：
- **重现步骤**：
- **影响范围**：
- **解决方案**：

### 问题2
- **描述**：
- **重现步骤**：
- **影响范围**：
- **解决方案**：

## 📝 测试建议

1. **准备多种角色卡**: 测试不同作者的MVU角色卡
2. **记录控制台**: 保存所有错误信息
3. **截图证明**: 重要功能截图保存
4. **版本记录**: 记录测试时的各组件版本
5. **反馈收集**: 记录用户反馈的兼容性问题

## ✨ 优化建议

基于测试结果，建议进行以下优化：
1. 
2. 
3. 

---

**测试日期**：_____________
**测试人员**：_____________
**测试环境**：_____________
